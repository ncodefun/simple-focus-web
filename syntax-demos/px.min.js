const isCEPolyfill=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,removeNodes=(container,startNode,endNode=null)=>{let node=startNode;for(;node!==endNode;){const n=node.nextSibling;container.removeChild(node),node=n}},directives=new WeakMap,isDirective=o=>directives.has(o),marker=`{{lit-${String(Math.random()).slice(2)}}}`,nodeMarker=`\x3c!--${marker}--\x3e`,markerRegex=new RegExp(`${marker}|${nodeMarker}`),rewritesStyleAttribute=(()=>{const el=document.createElement("div");return el.setAttribute("style","{{bad value}}"),"{{bad value}}"!==el.getAttribute("style")})();class Template{constructor(result,element){this.parts=[],this.element=element;let index=-1,partIndex=0;const nodesToRemove=[],_prepareTemplate=template=>{const content=template.content,walker=document.createTreeWalker(content,133,null,!1);let previousNode,currentNode;for(;walker.nextNode();){index++,previousNode=currentNode;const node=currentNode=walker.currentNode;if(1===node.nodeType){if(node.hasAttributes()){const attributes=node.attributes;let count=0;for(let i=0;i<attributes.length;i++)attributes[i].value.indexOf(marker)>=0&&count++;for(;count-- >0;){const stringForPart=result.strings[partIndex],name=lastAttributeNameRegex.exec(stringForPart)[2],attributeLookupName=rewritesStyleAttribute&&"style"===name?"style$":/^[a-zA-Z-]*$/.test(name)?name:name.toLowerCase(),strings=node.getAttribute(attributeLookupName).split(markerRegex);this.parts.push({type:"attribute",index,name,strings}),node.removeAttribute(attributeLookupName),partIndex+=strings.length-1}}"TEMPLATE"===node.tagName&&_prepareTemplate(node)}else if(3===node.nodeType){const nodeValue=node.nodeValue;if(nodeValue.indexOf(marker)<0)continue;const parent=node.parentNode,strings=nodeValue.split(markerRegex),lastIndex=strings.length-1;partIndex+=lastIndex;for(let i=0;i<lastIndex;i++)parent.insertBefore(""===strings[i]?createMarker():document.createTextNode(strings[i]),node),this.parts.push({type:"node",index:index++});parent.insertBefore(""===strings[lastIndex]?createMarker():document.createTextNode(strings[lastIndex]),node),nodesToRemove.push(node)}else if(8===node.nodeType)if(node.nodeValue===marker){const parent=node.parentNode,previousSibling=node.previousSibling;null===previousSibling||previousSibling!==previousNode||previousSibling.nodeType!==Node.TEXT_NODE?parent.insertBefore(createMarker(),node):index--,this.parts.push({type:"node",index:index++}),nodesToRemove.push(node),null===node.nextSibling?parent.insertBefore(createMarker(),node):index--,currentNode=previousNode,partIndex++}else{let i=-1;for(;-1!==(i=node.nodeValue.indexOf(marker,i+1));)this.parts.push({type:"node",index:-1})}}};_prepareTemplate(element);for(const n of nodesToRemove)n.parentNode.removeChild(n)}}const isTemplatePartActive=part=>-1!==part.index,createMarker=()=>document.createComment(""),lastAttributeNameRegex=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F \x09\x0a\x0c\x0d"'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class TemplateInstance{constructor(template,processor,getTemplate){this._parts=[],this.template=template,this.processor=processor,this._getTemplate=getTemplate}update(values){let i=0;for(const part of this._parts)void 0!==part&&part.setValue(values[i]),i++;for(const part of this._parts)void 0!==part&&part.commit()}_clone(){const fragment=isCEPolyfill?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),parts=this.template.parts;let partIndex=0,nodeIndex=0;const _prepareInstance=fragment=>{const walker=document.createTreeWalker(fragment,133,null,!1);let node=walker.nextNode();for(;partIndex<parts.length&&null!==node;){const part=parts[partIndex];if(isTemplatePartActive(part))if(nodeIndex===part.index){if("node"===part.type){const part=this.processor.handleTextExpression(this._getTemplate);part.insertAfterNode(node),this._parts.push(part)}else this._parts.push(...this.processor.handleAttributeExpressions(node,part.name,part.strings));partIndex++}else nodeIndex++,"TEMPLATE"===node.nodeName&&_prepareInstance(node.content),node=walker.nextNode();else this._parts.push(void 0),partIndex++}};return _prepareInstance(fragment),fragment}}const noChange={},isPrimitive=value=>null===value||!("object"==typeof value||"function"==typeof value);class AttributeCommitter{constructor(element,name,strings){this.dirty=!0,this.element=element,this.name=name,this.strings=strings,this.parts=[];for(let i=0;i<strings.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new AttributePart(this)}_getValue(){const strings=this.strings,l=strings.length-1;let text="";for(let i=0;i<l;i++){text+=strings[i];const part=this.parts[i];if(void 0!==part){const v=part.value;if(null!=v&&(Array.isArray(v)||"string"!=typeof v&&v[Symbol.iterator]))for(const t of v)text+="string"==typeof t?t:String(t);else text+="string"==typeof v?v:String(v)}}return text+=strings[l]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class AttributePart{constructor(comitter){this.value=void 0,this.committer=comitter}setValue(value){value===noChange||isPrimitive(value)&&value===this.value||(this.value=value,isDirective(value)||(this.committer.dirty=!0))}commit(){for(;isDirective(this.value);){const directive$$1=this.value;this.value=noChange,directive$$1(this)}this.value!==noChange&&this.committer.commit()}}class NodePart{constructor(templateFactory){this.value=void 0,this._pendingValue=void 0,this.templateFactory=templateFactory}insertAfterNode(ref){this.startNode=ref,this.endNode=ref.nextSibling}appendIntoPart(part){part._insert(this.startNode=createMarker()),part._insert(this.endNode=createMarker())}insertAfterPart(ref){ref._insert(this.startNode=createMarker()),this.endNode=ref.endNode,ref.endNode=this.startNode}setValue(value){this._pendingValue=value}commit(){for(;isDirective(this._pendingValue);){const directive$$1=this._pendingValue;this._pendingValue=noChange,directive$$1(this)}const value=this._pendingValue;value!==noChange&&(isPrimitive(value)?value!==this.value&&this._commitText(value):value instanceof TemplateResult?this._commitTemplateResult(value):value instanceof Node?this._commitNode(value):Array.isArray(value)||value[Symbol.iterator]?this._commitIterable(value):void 0!==value.then?this._commitPromise(value):this._commitText(value))}_insert(node){this.endNode.parentNode.insertBefore(node,this.endNode)}_commitNode(value){this.value!==value&&(this.clear(),this._insert(value),this.value=value)}_commitText(value){const node=this.startNode.nextSibling;value=null==value?"":value,node===this.endNode.previousSibling&&node.nodeType===Node.TEXT_NODE?node.textContent=value:this._commitNode(document.createTextNode("string"==typeof value?value:String(value))),this.value=value}_commitTemplateResult(value){const template=this.templateFactory(value);let instance;if(this.value&&this.value.template===template)instance=this.value;else{const fragment=(instance=new TemplateInstance(template,value.processor,this.templateFactory))._clone();isCEPolyfill&&!this.endNode.isConnected&&(document.adoptNode(fragment),customElements.upgrade(fragment)),this._commitNode(fragment),this.value=instance}instance.update(value.values)}_commitIterable(value){Array.isArray(this.value)||(this.value=[],this.clear());const itemParts=this.value;let itemPart,partIndex=0;for(const item of value)void 0===(itemPart=itemParts[partIndex])&&(itemPart=new NodePart(this.templateFactory),itemParts.push(itemPart),0===partIndex?itemPart.appendIntoPart(this):itemPart.insertAfterPart(itemParts[partIndex-1])),itemPart.setValue(item),itemPart.commit(),partIndex++;partIndex<itemParts.length&&(itemParts.length=partIndex,this.clear(itemPart&&itemPart.endNode))}_commitPromise(value){this.value=value,value.then(v=>{this.value===value&&(this.setValue(v),this.commit())})}clear(startNode=this.startNode){removeNodes(this.startNode.parentNode,startNode.nextSibling,this.endNode)}}class BooleanAttributePart{constructor(element,name,strings){if(this.value=void 0,this._pendingValue=void 0,2!==strings.length||""!==strings[0]||""!==strings[1])throw new Error("Boolean attributes can only contain a single expression");this.element=element,this.name=name,this.strings=strings}setValue(value){this._pendingValue=value}commit(){for(;isDirective(this._pendingValue);){const directive$$1=this._pendingValue;this._pendingValue=noChange,directive$$1(this)}if(this._pendingValue===noChange)return;const value=!!this._pendingValue;this.value!==value&&(value?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)),this.value=value,this._pendingValue=noChange}}class PropertyCommitter extends AttributeCommitter{constructor(element,name,strings){super(element,name,strings),this.single=2===strings.length&&""===strings[0]&&""===strings[1]}_createPart(){return new PropertyPart(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class PropertyPart extends AttributePart{}class EventPart{constructor(element,eventName){this.value=void 0,this._pendingValue=void 0,this.element=element,this.eventName=eventName}setValue(value){this._pendingValue=value}commit(){for(;isDirective(this._pendingValue);){const directive$$1=this._pendingValue;this._pendingValue=noChange,directive$$1(this)}this._pendingValue!==noChange&&(null==this._pendingValue!=(null==this.value)&&(null==this._pendingValue?this.element.removeEventListener(this.eventName,this):this.element.addEventListener(this.eventName,this)),this.value=this._pendingValue,this._pendingValue=noChange)}handleEvent(event){"function"==typeof this.value?this.value.call(this.element,event):"function"==typeof this.value.handleEvent&&this.value.handleEvent(event)}}class TemplateProcessor{handleAttributeExpressions(element,name,strings){const prefix=name[0];if("."===prefix){return new PropertyCommitter(element,name.slice(1),strings).parts}if("@"===prefix){let eventName=name.slice(1);return"press"===eventName?eventName=window.is_touch?"touchstart":"mousedown":"release"===eventName&&(eventName=window.is_touch?"touchend":"mouseup"),[new EventPart(element,eventName)]}return"?"===prefix?[new BooleanAttributePart(element,name.slice(1),strings)]:new AttributeCommitter(element,name,strings).parts}handleTextExpression(templateFactory){return new NodePart(templateFactory)}}const defaultTemplateProcessor=new TemplateProcessor;class TemplateResult{constructor(strings,values,type,processor=defaultTemplateProcessor){this.strings=strings,this.values=values,this.type=type,this.processor=processor}getHTML(){const l=this.strings.length-1;let html="",isTextBinding=!0;for(let i=0;i<l;i++){const s=this.strings[i];html+=s;const close=s.lastIndexOf(">");!(isTextBinding=(close>-1||isTextBinding)&&-1===s.indexOf("<",close+1))&&rewritesStyleAttribute&&(html=html.replace(lastAttributeNameRegex,(match,p1,p2,p3)=>"style"===p2?`${p1}style$${p3}`:match)),html+=isTextBinding?nodeMarker:marker}return html+=this.strings[l]}getTemplateElement(){const template=document.createElement("template");return template.innerHTML=this.getHTML(),template}}function templateFactory(result){let templateCache=templateCaches.get(result.type);void 0===templateCache&&(templateCache=new Map,templateCaches.set(result.type,templateCache));let template=templateCache.get(result.strings);return void 0===template&&(template=new Template(result,result.getTemplateElement()),templateCache.set(result.strings,template)),template}const templateCaches=new Map;function render(result,container,templateFactory$$1=templateFactory){const template=templateFactory$$1(result);let instance=container.__templateInstance;if(void 0!==instance&&instance.template===template&&instance.processor===result.processor)return void instance.update(result.values);instance=new TemplateInstance(template,result.processor,templateFactory$$1),container.__templateInstance=instance;const fragment=instance._clone();removeNodes(container,container.firstChild),isCEPolyfill&&!container.isConnected&&(document.adoptNode(fragment),customElements.upgrade(fragment)),container.appendChild(fragment),instance.update(result.values)}const html=(strings,...values)=>new TemplateResult(strings,values,"html");function createApp(cfg){config=cfg,initStore(),app=c.modelInstance("app",{target:"body",template(){let prev=c.get(this.prev_scene);return html`
			<main 
				id='app'
				data-flow='col'
				class='${this.ready?"ready":""}' 
				data-view='${this.scene}'
				>
				${prev&&prev.viewIn(this,null,"old-scene")}
				${this.scene&&c.get(this.scene).viewIn(this,null,"scene")}
			</main>`},props:{ready:!1,lang:{value:navigator.language.slice(0,2),store:!0},scene:{value:null,transformer(val,prev){return this.scene&&(this.prev_scene=this.scene),val}},prev_scene:null,fullscreen_enabled:!1},strings:{title:{en:"defi app",fr:"defi app"}},afterRender(){resize()},afterResize(){q("main > section.scene").classList.add("show"),q("main > section.old-scene")&&q("main > section.old-scene").classList.add("fade")}})}const q=document.querySelector.bind(document),isObject=o=>o&&"object"==typeof o&&!Array.isArray(o),clamp=(num,min,max)=>Math.max(Math.min(num,max),min),range=(start,end)=>Array.from({length:end-start+1},(v,k)=>k+start),log=(style="green",...msg)=>{const common="padding:0 10px; border-radius:10px 0 0 10px;",commonsub="padding:0 10px; border-radius:0 10px 10px 0;",cstyles={green:"background:green; color: white;"+common,yellow:"background:yellow; color: black;"+common,blue:"background:#0080FF; color: white;"+common,orange:"background:GOLD; color: black;"+common,red:"background:darkred; color: white;"+common,greenorange:"background: #778111; color: white; border:1px solid orange;"+common};Object.assign(cstyles,{info:cstyles.blue,check:cstyles.yellow,ok:cstyles.green,notok:cstyles.greenorange,err:cstyles.red,warn:cstyles.orange});const csubstyles={green:"background:darkgreen; color: white;"+commonsub,yellow:"background:#B5B500; color: black;"+commonsub,blue:"background:#0058B0; color: white;"+commonsub,orange:"background:#887400; color: white;"+commonsub,red:"background:#5F0207; color: white;"+commonsub,greenorange:"background: #585F0D; color: white; border:1px solid orange;"+common};Object.assign(csubstyles,{info:csubstyles.blue,check:csubstyles.yellow,ok:csubstyles.green,notok:csubstyles.greenorange,err:csubstyles.red,warn:csubstyles.orange}),msg.length?msg.length>1?console.log("%c"+msg.join("%c"),cstyles[style],...Array(msg.length-1).fill(csubstyles[style])):console.log("%c"+msg,cstyles[style]):console.log(style)};function debounced(callback,dly,dyn_dly=!1){let t=0;return dyn_dly?function(delay=0,...params){clearTimeout(t),t=setTimeout(callback,delay||dly,...params)}:function(...params){clearTimeout(t),t=setTimeout(callback,dly,...params)}}function throttled(callback,dly){let d,last_run,t;return function(...params){clearTimeout(t),(d=Date.now())-last_run<dly?t=setTimeout(callback,dly,...params):(last_run=d,callback(...params))}}function chunk(arr,n){return arr.reduce((cumul,item,i)=>{const index=Math.floor(i/n);return cumul[index]||(cumul[index]=[]),cumul[index].push(item),cumul},[])}const locationHash=()=>{let h=decodeURI(location.hash.slice(1));return"/"===h?"":(h.startsWith("/")&&(h=h.slice(1)),h.endsWith("/")&&(h=h.slice(0,-1)),h)};function fieldSorter(fields){return(a,b)=>fields.map(o=>{let dir=1;return"-"===o[0]&&(dir=-1,o=o.substring(1)),a[o]>b[o]?dir:a[o]<b[o]?-dir:0}).reduce((p,n)=>p||n,0)}function mixLiteral(strings,...values){const len=strings.length;let index,result="";for(index=0;index<len;index++)result+=strings[index],index<len-1&&(result+=values[index]);return result}function minim(strings,...values){return mixLiteral(strings,...values).replace(/\t{2,}/gm,"\t").replace(/\n|\t/gm," ")}function loadScript(src,callback,use_version=!1){let s=document.createElement("script");callback&&(s.onload=callback),document.head.appendChild(s),use_version&&(src+="?"+window.APP_VERSION),s.src=src}function loadScripts(arr,callback){let loaded=0;function onLoaded(){++loaded===arr.length&&callback()}arr.forEach(s=>loadScript(s,onLoaded))}function switchClasses(el,a,b,cond){a.includes(" ")?a.split(" ").forEach(clss=>el.classList.toggle(clss,cond)):el.classList.toggle(a,cond),b.includes(" ")?b.split(" ").forEach(clss=>el.classList.toggle(clss,!cond)):el.classList.toggle(b,!cond)}const arrayOf=n=>range(0,n-1),arrayFill=(len,fill)=>Array.from({length:len},_=>fill),cycle=(from_val,vals,dir=">>",wrap=null)=>">>"===dir?vals[nextIndexOf(from_val,vals,null!==wrap?wrap:dir.endsWith("|"))]:vals[prevIndexOf(from_val,vals,null!==wrap?wrap:dir.startsWith("|"))],nextIndexOf=(val,vals,wrap=!0)=>nextIndex(vals.indexOf(val),vals.length,wrap),prevIndexOf=(val,vals,wrap=!0)=>prevIndex(vals.indexOf(val),vals.length,wrap),nextIndex=(index,len,wrap=!0)=>wrap||index!==len-1?wrapIndex(++index,len):len-1,prevIndex=(index,len,wrap=!0)=>wrap||0!==index?wrapIndex(--index,len):0,wrapIndex=(index,len)=>(index%len+len)%len;function revive(val){return""===val?val:"true"==val||"false"!=val&&(!1===/[^\d.]/.test(val)?(log("warn","returning a number:",val),parseFloat(val)):val.includes(",")?(log("err","returning original value",val),val):val.trim())}const floor=(num,step=1)=>"string"==typeof step?Math.floor(num*parseInt(step))/parseInt(step):Math.floor(num/step)*step,models={},instances={},scenes=[],params=[];let app,stage,store,config,auto_name=0,block_render=!1;function initStore(){if(log("info","init store"),!config.store_id)return void log("err","no store_id on config");let stored_data=localStorage.getItem(config.store_id);if(stored_data)try{store=JSON.parse(stored_data)}catch(err){log("JSON parse error")}store&&isObject(store)||(log("err","NO STORE, CREATING ONE"),store={models:{},instances:{}})}function saveStore(){log(JSON.stringify(store,null,1)),localStorage.setItem(config.store_id,JSON.stringify(store))}function model(name,obj){const props_desc={};for(let model_prop in obj.props){let desc=obj.props[model_prop];isObject(desc)&&(void 0!==desc.value||desc.render||desc.watcher||desc.transformer)||(desc={value:desc});let model_store=store.models[name];desc.store&&model_store&&void 0!==model_store[model_prop]&&(desc.value=model_store[model_prop]),desc.store&&!model_store&&(model_store=store.models[name]={}),Object.defineProperty(props_desc,model_prop,{get(){return desc.getter?desc.getter.call(this):this.__proto__["_"+model_prop]},set(val){let prev_val=this.__proto__["_"+model_prop];desc.transformer&&(val=desc.transformer.call(this,val,prev_val)),!0===desc.store&&(model_store[model_prop]=val,saveStore()),this.__proto__["_"+model_prop]=val,desc.watcher&&desc.watcher.call(this,val,prev_val),desc.afterRender&&setTimeout(_=>desc.afterRender.call(this,val,prev_val)),setTimeout(_=>callbacks(this,"afterRender")),this.hasOwnProperty(model_prop)||this.renderTop()}}),props_desc["_"+model_prop]=desc.value}obj.props=null,obj.__name=name,models[name]={proto:obj,props_desc:Object.getOwnPropertyDescriptors(props_desc)}}function instance(inst_name,obj){inst_name=inst_name||"auto_"+ ++auto_name,log("ok","creating instance:",inst_name,obj.model);let m=models[obj.model];const inst_proto=Object.create(m.proto);Object.defineProperties(inst_proto,m.props_desc);const props_desc={};for(let inst_prop in obj.props){let desc=obj.props[inst_prop];isObject(desc)&&(void 0!==desc.value||desc.render||desc.watcher||desc.transformer)||(desc={value:desc});let inst_store=inst_name&&store.instances[inst_name];desc.store&&inst_store&&void 0!==inst_store[inst_prop]&&(desc.value=inst_store[inst_prop]),desc.store&&!inst_store&&inst_name&&(inst_store=store.instances[inst_name]={}),void 0!==desc.param&&params.push({comp:inst_name,prop:inst_prop,name:desc.param,order:0}),Object.defineProperty(props_desc,inst_prop,{get(){return desc.getter?desc.getter.call(this):this["_"+inst_prop]},set(val){if(desc.values){let old=this["_"+inst_prop];val=cycle(old,desc.values,val)}if(this.model.hasOwnProperty(inst_prop)&&(this.model[inst_prop]=val),this.hasOwnProperty(inst_prop)){let prev_val=this["_"+inst_prop];if(desc.transformer&&(val=desc.transformer.call(this,val,prev_val)),!0===desc.store&&(inst_store[inst_prop]=val,saveStore()),this["_"+inst_prop]=val,desc.watcher&&desc.watcher.call(this,val,prev_val),void 0!==desc.param&&updateParam(inst_name,inst_prop,val),inst_prop in this.bindings){let sel=this.bindings[inst_prop];q(sel).value=val}}if(this.renderTop(),this.hasOwnProperty(inst_prop)){let prev_val=this["_"+inst_prop];desc.afterRender&&desc.afterRender.call(this,val,prev_val)}}}),props_desc["_"+inst_prop]=desc.value}obj.props=null;const inst=Object.create(inst_proto,Object.getOwnPropertyDescriptors(props_desc));return instances[inst_name]=Object.assign(inst,obj,{__name:inst_name,model:m.proto,components:new Set,string(str_name){let str=this.strings&&this.strings[str_name];return str&&str[instances.app.lang]},update(props,nest_with_class=""){return props&&(block_render=!0,Object.assign(this,props)),this.template(nest_with_class)},renderTop(){let top_parent=this;for(;top_parent.parent;)top_parent=top_parent.parent;top_parent.target?top_parent.render():log("no target, not rendering")},render(target,props){target||this.target?(target&&(this.target=target),invalidate(this,props,target)):this.renderTop()},onRender(){callbacks(this,"afterRender"),function callComponents(comps){if(comps.size)for(let c of comps)callbacks(c,"afterRender"),callComponents(c.components)}(this.components)},nest(parent,props,nest_with_class){if(!parent)throw Error("nest requires a parent parameter: nest(this)");return this.parent=parent,parent.components.has(this)||parent.components.add(this),this.update(props,nest_with_class)},bindings:{},upgrade(obj){Object.assign(this,obj)}}),instances[inst_name].viewIn=instances[inst_name].nest,obj.scene&&scenes.push(instances[inst_name]),instances[inst_name]}function modelInstance(name,obj){return model(name,{template:obj.template}),delete obj.template,instance(name,Object.assign({model:name},obj))}function callbacks(inst,callback_name){inst.model.hasOwnProperty(callback_name)&&inst.model[callback_name](),inst.hasOwnProperty(callback_name)&&inst[callback_name]()}async function invalidate(instance,props,target,child_caller){instance.needsRender||(instance.needsRender=!0,await 0,instance.needsRender=!1,_render(instance,props,target,child_caller)&&instance.onRender())}function _render(instance,props,target,child_caller){if(log("warn","rendering"),"string"==typeof instance&&(instance=instances[instance]),!instance)return console.error("no instance:",instance_name),!1;let result=instance.update(props);return block_render?(log("err","Rendering Blocked"),block_render=!1,!1):(target=target||instance.target)?(render(result,q(target)),q(target).dataset.view=instance.__name,!0):(console.error("no target defined and no default:",instance.__name),!1)}function afterResize(){for(let name in instances)callbacks(instances[name],"afterResize")}function get(name){return instances[name]}function resize(){if(stage||(stage=q("#app")),!stage)return;log("warn","resize");let w=window.innerWidth,h=window.innerHeight;const sc=config;let AR=((w=Math.min(w,h*sc.AR_max))/(h=Math.min(h,w*(1/sc.AR_tallest)))).toFixed(4).slice(0,-1),AR_tallest=config.AR_tallest.toFixed(4).slice(0,-1),margin=AR>=config.AR_max.toFixed(4).slice(0,-1)||AR<=AR_tallest?sc.cross_margin:0;w-=2*margin,h-=2*margin,stage.style.width=w+"px",stage.style.height=h+"px",stage.classList.toggle("has-cross-margins",!!margin);const base_h=Math.min(h,w*(1/sc.AR_min));document.documentElement.style.fontSize=base_h/8+"px",document.body.style.setProperty("--h",h+"px"),document.body.style.setProperty("--w",w+"px"),setTimeout(afterResize);let extra_w=w-base_h*config.AR_min;document.body.style.setProperty("--cell-w",Math.floor(extra_w/5)+"px")}const component={get,model,instance,modelInstance,afterResize,scenes,params,CSS},c=component;function setTouchFalse(){log("info","setTouchFalse"),window.is_touch=!1,document.body.removeEventListener("mousedown",setTouchFalse),document.body.removeEventListener("touchstart",setTouchTrue)}function setTouchTrue(){log("info","setTouchTrue"),window.is_touch=!0,document.body.removeEventListener("mousedown",setTouchFalse),document.body.removeEventListener("touchstart",setTouchTrue),log("app:"),log(app),app.render()}window.addEventListener("resize",throttled(resize,200)),window.addEventListener("unload",e=>{log("err","unload"),saveStore()}),document.body.addEventListener("mousedown",setTouchFalse),document.body.addEventListener("touchstart",setTouchTrue);const listeners={press(callback,allow_scroll){return window.is_touch?e=>{allow_scroll||e.preventDefault(),callback.call(this,e)}:e=>{if("left"!=clickType(e))return e.stopPropagation(),e.preventDefault(),!1;callback.call(this,e)}},input(selector,bind_component,bind_prop,callback){bind_component.bindings[bind_prop]=selector;return e=>{let val=e.target.value;bind_component[bind_prop]=val,bind_component[bind_prop]!==val&&(e.target.value=bind_component[bind_prop]),callback&&callback()}},allowKeys(keys,special_chars=["Backspace","Tab","Enter","Space"]){if(Array.isArray(keys))return special_chars&&(keys=keys.concat(special_chars)),function(e){keys.includes(e.key)||e.preventDefault()};let re=keys;return function(e){re.test(e.key)||special_chars&&special_chars.includes(e.key)||e.preventDefault()}},disallowKeys:keys=>Array.isArray(keys)?function(e){keys.includes(e.key)&&e.preventDefault()}:function(e){keys.test(e.key)&&e.preventDefault()}},ease={linear:t=>t,in:(t,p=2)=>Math.pow(t,p),out:(t,p=2)=>1-Math.abs(Math.pow(t-1,p)),inOut:(t,p=2)=>t<.5?ease.in(2*t,p)/2:ease.out(2*t-1,p)/2+.5,outIn:(t,p=2)=>t<.5?ease.out(2*t,p)/2:ease.in(2*(t-.5),p)/2+.5,inCirc:t=>-1*(Math.sqrt(1-t*t)-1),outCirc:t=>1*Math.sqrt(1-(t-=1)*t),inOutCirc:t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),inExpo:t=>0==t?0:1*Math.pow(2,10*(t/1-1)),outExpo:t=>1==t?1:1*(1-Math.pow(2,-10*t/1)),inOutExpo:t=>0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},smoothedEase=(ease,smoothing)=>(val,power=2,eased)=>(eased=ease(val,power))-(eased-val)*smoothing;function clickType(e){let clickType="left";return e.which&&(3===e.which?clickType="right":2===e.which&&(clickType="middle")),clickType}function getColRowAtIndex(index,cols){log("info","getColRowAtIndex()",index);let col=index%cols,row=(index-index%cols)/cols;return log("check","col, row:",col,row),[col,row]}const itOpt_proto={value(index){return void 0!==index&&(this.current_index=index),this.options[this.current_index]},next(){return this.value(nextIndex(this.current_index,this.options.length))},prev(){return this.value(prevIndex(this.current_index,this.options.length))}};function itOpt(options,current_index=0){return Object.create(itOpt_proto,{options,current_index})}itOpt.curr=itOpt.current=itOpt.val=itOpt.value,function(){var a="undefined"!=typeof window&&void 0!==window.document?window.document:{},b="undefined"!=typeof module&&module.exports,c="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,d=function(){for(var b,c=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],d=0,e=c.length,f={};d<e;d++)if((b=c[d])&&b[1]in a){for(d=0;d<b.length;d++)f[c[0][d]]=b[d];return f}return!1}(),e={change:d.fullscreenchange,error:d.fullscreenerror},f={request:function(b){var e=d.requestFullscreen;b=b||a.documentElement,/5\.1[.\d]* Safari/.test(navigator.userAgent)?b[e]():b[e](c&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){a[d.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},on:function(b,c){var d=e[b];d&&a.addEventListener(d,c,!1)},off:function(b,c){var d=e[b];d&&a.removeEventListener(d,c,!1)},raw:d};d?(Object.defineProperties(f,{isFullscreen:{get:function(){return Boolean(a[d.fullscreenElement])}},element:{enumerable:!0,get:function(){return a[d.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(a[d.fullscreenEnabled])}}}),b?module.exports=f:window.screenfull=f):b?module.exports=!1:window.screenfull=!1}();export{createApp,q,isObject,clamp,range,log,debounced,throttled,chunk,locationHash,fieldSorter,mixLiteral,minim,loadScript,loadScripts,switchClasses,arrayOf,arrayFill,cycle,nextIndexOf,prevIndexOf,nextIndex,prevIndex,wrapIndex,revive,floor,saveStore,component,listeners,ease,smoothedEase,getColRowAtIndex,itOpt,html};